plugins {
    id "org.sonarqube" version "3.2.0"
}

ext.myBuildNumber='SNAPSHOT'
if ( hasProperty('buildNumber') ) {
    myBuildNumber = "${project.ext.buildNumber}"
}
version = "V2.0." + "${project.ext.myBuildNumber}"

sonarqube {
    properties {
        property "sonar.projectKey", "website-magyar_orokimadas"
        property "sonar.organization", "website-magyar"
        property "sonar.host.url", "https://sonarcloud.io"
        property "sonar.java.checkstyle.reportPaths", "build/reports/checkstyle/main.xml"
        property "sonar.exclusions", "**/external/**/*";
    }
}

subprojects {
    group = 'website.magyar.adorapp'
    apply plugin: 'idea'
    apply plugin: 'checkstyle'
    apply plugin: 'java'
    apply plugin: 'jacoco'

    jacoco {
        toolVersion = "0.8.6"
    }
    jacocoTestReport {
        reports {
            xml.enabled true
        }
    }
    test.finalizedBy jacocoTestReport

    // Source and target info
    sourceCompatibility = JavaVersion.VERSION_11
    targetCompatibility = JavaVersion.VERSION_11

    compileJava {
        options.encoding = "UTF-8"
    }

    repositories {
        maven { url "https://repo.maven.apache.org/maven2" }
    }

    checkstyle.configFile = file("$rootProject.rootDir/config/checkstyle/checkstyle.xml")
    checkstyle.configProperties = ['samedir' : "$rootProject.rootDir/config/checkstyle"]
    checkstyle.toolVersion = '8.0'
    checkstyle.ignoreFailures = true

    subprojects {
        task allDeps(type: DependencyReportTask) {}
    }
}

if (hasProperty('buildScan')) {
    buildScan {
        termsOfServiceUrl = 'https://gradle.com/terms-of-service'
        termsOfServiceAgree = 'yes'
    }
}
